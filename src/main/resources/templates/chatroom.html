<!DOCTYPE html>
<html lang="en" xmlns:th="http://thymeleaf.org">
<head>

    <title th:if="${user==null || chatRoom==null}">Error!!!</title>
    <style>
        h1, h2, h4 {display: inline;}

        h1, h4 {color: #3498db;}
    </style>
</head>
<body>
<div th:if="${user==null || chatRoom==null}">
    <h3 style="color:#ff5959">Wrong page</h3><h3>!!! Set user and Channel on welcome page</h3>
    <a th:href="@{/welcome}" style="margin-right:2em">Go to welcome page</a>
</div>
<div th:if="${user!=null and chatRoom!=null}">
    <h2>Channel:</h2>
    <h1>[[${chatRoom.chatRoomName}]] </h1>|<h2> User:</h2><h1>[[${user.username}]]</h1>
<!--    <div th:each=" user: ${chatRoom.users}">-->
<!--        <h1>[[${user.username}]]</h1>-->
<!--    </div>-->
    <div th:each="message: ${chatRoom.messages}">
        <h4>[[${message.user.username}]]:</h4>  <h4 style="color: black">[[${message.stringMessage}]]</h4>
    </div>
    <form th:action="@{/chatroom/{room_id}/user_id/{user_id}(room_id=${chatRoom.room_id},user_id=${user.user_id})}"
          method="post">
        <input type="hidden" th:field="${chatRoom.room_id}" id="room_id">
        <input type="hidden" th:field="${user.user_id}">
        <input type="text" th:field="${message.stringMessage}" placeholder="message here">
        <button type="submit" style="color:blue" id="sendButton">Send</button>
    </form>
    <div>
        <a th:href="@{/welcome/deactivate/{room_id}/user/{user_id}(room_id=${chatRoom.room_id},user_id=${user.user_id})}" style="margin-right:2em">Back</a>
    </div>
</div>
<script>
var sendButton = document.getElementById("sendButton");

sendButton.addEventListener("click", async function() {
  try {
    const room_id = chatRoom.room_id; // Ensure chatRoom is defined and has a room_id property
    const response = await fetch(`http://localhost:8080/chatroom/${room_id}/messages?room_id=${room_id}`);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const responseJson = await response.json();
    console.log(responseJson);
  } catch (error) {
    console.error("An error occurred:", error);
  }
});



</script>

</body>
</html>